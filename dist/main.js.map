{"version":3,"sources":["webpack://SKUFilter/webpack/universalModuleDefinition","webpack://SKUFilter/webpack/bootstrap","webpack://SKUFilter/./src/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","SKUFilter","props","_classCallCheck","this","data","slice","format_skus","sku_types","convenient_render","conditions","selected_types","selected_detail","match_skus","mismatch_skus","final_sku","target","skus","Array","length","Set","format_sku","Map","map","x","obj","entries","type","_ref","_ref2","_slicedToArray","k","v","add","toString","set","_toConsumableArray","sku","every","condition","keys","concat","includes","push","render_list","_ref3","_ref4","has","check","_type","find","_ref5","_ref6"],"mappings":"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","file":"main.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SKUFilter\"] = factory();\n\telse\n\t\troot[\"SKUFilter\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/**\n* TODO: 过滤SKU\n*\n* @param {Array} new skuFilter({data: skus});\n*\n* @param {Funtion} initial() => {\n*    skus: <Array>, // 所有的sku[{颜色: \"红\", 大小: \"S\", 性别: \"男\"}, {颜色: \"红\", 大小: \"XL\", 性别: \"女\"}]\n*    sku_types: <Array>, // 所有的sku类型key[\"颜色\", \"大小\", \"性别\"]\n*    convenient_render: <Map> // 方便渲染的格式{\"颜色\" => [红, 黑], \"大小\" => [L, XL], \"性别\" => [男, 女]}\n* }\n*\n* @param {Function} filter(conditions<Array>) => {\n*        selected_types<Array>, // 已选类型 [\"颜色\", \"大小\", \"性别\"]\n*        selected_detail<String>, // 已选的具体参数 每次点击的时候显示已选的参数 \"颜色: 红 大小: XL \"\n*        match_skus<Array>, // 符合条件的sku [{颜色: \"红\", 大小: \"XL\", 性别: \"男\"}]\n*        mismatch_skus<Array>, // 不符合条件的sku [{颜色: \"红\", 大小: \"XL\", 性别: \"男\"}]\n*        render_list<Array>, // 更新视图方便, 符合条件的参数 [{颜色: \"红\"}, {大小: \"XL\"}, {性别: \"男\"}]\n*        final_sku<Object>, // 符合全部已选条件的sku {颜色: \"红\", 大小: \"XL\", 性别: \"男\"} || null\n*        target<Object>, //  加入购物车或者立即购买 需要提交的完整sku {\n*                            description: null,\n*                            id: 107,\n*                            image: \"default_point_shop_product_sku.jpg\",\n*                            name: null,\n*                            point_shop_product_id: \"3\",\n*                            price: {level1: \"10\", level2: \"5\"},\n*                            stock: \"9999991\",\n*                            type: {颜色: \"红\", 大小: \"XL\", 性别: \"男\"}\n*                          }\n* }\n*\n* @example \n* 1. 获得实例\n*    const skus = new SKUFilter({data: skus<Array>})\n* 2. 格式化数据\n*    const skus.initial();\n* 3. 输入已选条件, 过滤数据\n*    const result = skus.filter(conditions<Array>); [{颜色: '红'}]\n*    \n* @author PengZiXiu\n**/\nclass SKUFilter {\n\n    constructor(props){\n        this.data = props.data.slice();\n        this.format_skus = [];\n        this.sku_types = [];\n        this.convenient_render = null;\n\n        this.conditions = [];\n        this.selected_types = [];\n        this.selected_detail = ``;\n        this.match_skus = [];\n        this.mismatch_skus = [];\n        this.final_sku = null;\n\n        this.target = null;\n    }\n\n    // 初始化数据结构\n    initial(){\n        const skus = this.data; // 原始数据格式 sku => {id: 123456799, types: [{颜色: 红}, {尺码: XL}]}\n        if(skus instanceof Array, skus.length > 0){\n\n            let sku_types = new Set(); // 总的类型Key的数组\n            let format_sku = new Set(); // 格式化一遍的sku => {颜色: '红', 大小: 'XL'}\n            let m = new Map(); // key为类型 value为类型下的参数，没有重复值方便渲染\n            skus.map(x=>{\n                let obj = {};\n                Object.entries(x.type).map(([k, v])=>{\n                    sku_types.add(k);\n                    obj[k.toString()] = v.toString();\n\n                    m.get(k) ? m.set(k, m.get(k).add(v)) : m.set(k, new Set([v]));\n                })\n                format_sku.add(obj);\n            });\n            this.format_skus = [...format_sku];\n            this.sku_types = [...sku_types];\n            this.convenient_render = m;\n            return {skus: [...format_sku], sku_types: [...sku_types], convenient_render: m}\n\n        }else{\n          return false\n        }\n    }\n\n    // 过滤sku\n    filter(conditions){\n\n        let match_skus = []; // 符合条件的sku\n        let mismatch_skus = []; // 不符合条件的sku\n        let selected_types = []; // 已选的类型\n        let selected_detail = ``; // 已选的具体参数\n        this.format_skus.map((sku, i)=>{\n            let all = conditions.every(condition=>{\n                const k = Object.keys(condition)[0];\n                i === 0 ? (selected_detail += `${k}: ${condition[k]} `) : null;\n                selected_types.includes(k) ? null : selected_types.push(k);\n                if(sku[k] === condition[k]){\n                    return true\n                }\n            });\n            all ? match_skus.push(sku) : mismatch_skus.push(sku);\n        })\n        this.selected_types = selected_types;\n        this.selected_detail = selected_detail;\n        this.match_skus = match_skus;\n        this.mismatch_skus = mismatch_skus;\n\n\n        let render_list = []; // 需要渲染的typs[{颜色: '红'}, {尺码: 'XL'}, ......]\n        let m = new Map();\n        match_skus.map(sku=>{\n            Object.entries(sku).map(([k, v])=>{\n                let obj = null;\n                if(m.get(k)){\n                    if(!m.get(k).has(v)){\n                        obj = {};\n                        obj[k] = v\n                    }\n                    m.set(k, m.get(k).add(v));\n                }else{\n                    m.set(k, new Set([v]));\n                    obj = {};\n                    obj[k] = v;\n                }\n                obj ? render_list.push(obj) : null;\n            })\n        })\n        \n\n        let final_sku = null; // 最终符合条件的sku.types\n        if(conditions.length === this.sku_types.length && this.match_skus.length === 1){\n            let isok = this.sku_types.every(type=>{\n                let check = null;\n                Object.keys(match_skus[0]).map(_type=>{\n                    if(type === _type){\n                        check = true\n                    }\n                })\n                return check\n            })\n            isok ? (final_sku = match_skus[0]) : null;\n        }\n        this.final_sku = final_sku;\n\n        let target = null; // 根据映射关系找到最终的sku\n        if(final_sku){\n            target = this.data.find(sku=>{\n                let isok = Object.entries(final_sku).every(([k,v])=>{\n                if(sku.type[k] === v){\n                    return true\n                }\n                })\n                return isok\n            })\n        }\n\n        return {\n            selected_types,\n            selected_detail,\n            match_skus,\n            mismatch_skus,\n            render_list,\n            final_sku,\n            target\n        }\n    }\n\n}\n\nmodule.exports = SKUFilter"],"sourceRoot":""}